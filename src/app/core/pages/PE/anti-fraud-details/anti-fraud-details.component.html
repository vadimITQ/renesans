<div class="anti-fraud-details-header">
  <pe-indent [mTop]="4"></pe-indent>
  <pe-back-arrow (listenBack)="back()"></pe-back-arrow>
  <pe-indent [mBottom]="3"></pe-indent>
</div>

<div class="anti-fraud-details pe-border" [formGroup]="form" *ngIf="hasAccessToComponent">

  <h5>AntiFraud проверка: просмотр деталей по заявке</h5>

  <div class="paragraph">
    <pe-indent [mTop]="3"></pe-indent>
    Информация по заявке
    <pe-indent [mBottom]="6"></pe-indent>
  </div>

  <div class="info-block" *ngIf="!loading; else elseBlock">

    <pe-input-form [control]="form.controls.paymentID"        label="ID PE"                                    [labelStyle]="labelsStyle" [disabled]="true"></pe-input-form>
    <pe-input-form [control]="form.controls.pmtCreationTime"  label="Дата заявки PE"                           [labelStyle]="labelsStyle" [disabled]="true"></pe-input-form>
    <pe-input-form [control]="form.controls.payerName"        label="ФИО плательщика/наименования организации" [labelStyle]="labelsStyle" [disabled]="true"></pe-input-form>
    <pe-input-form [control]="form.controls.payerAccount"     label="Счёт списания"                            [labelStyle]="labelsStyle" [disabled]="true"></pe-input-form>
    <pe-input-form [control]="form.controls.payeeName"        label="ФИО получателя/наименования организации"  [labelStyle]="labelsStyle" [disabled]="true"></pe-input-form>
    <pe-input-form [control]="form.controls.payeeAccount"     label="Счёт получателя"                          [labelStyle]="labelsStyle" [disabled]="true"></pe-input-form>
    <pe-input-form [control]="form.controls.payeeINN"         label="ИНН получателя"                           [labelStyle]="labelsStyle" [disabled]="true"></pe-input-form>
    <pe-input-form [control]="form.controls.payeeBIC"         label="БИК банка получателя"                     [labelStyle]="labelsStyle" [disabled]="true"></pe-input-form>
    <pe-input-form [control]="form.controls.paymentPurpose"   label="Назначение"                               [labelStyle]="labelsStyle" [disabled]="true"></pe-input-form>
    <pe-input-form [control]="form.controls.amount"           label="Сумма перевода"                           [labelStyle]="labelsStyle" [disabled]="true"></pe-input-form>
  
  </div>
  <ng-template #elseBlock>
    <pe-loading-spinner></pe-loading-spinner>
  </ng-template>

  <div class="paragraph">
    <pe-indent [mTop]="3"></pe-indent>
    Автоматические проверки
    <pe-indent [mBottom]="4"></pe-indent>
  </div>

  <div class="automatic-checks">
    <p-table
      *ngIf="!loading"
      [value]="form.controls.autoChecks.value"
      [scrollable]="true"
      [autoLayout]="true"
      [resizableColumns]="true"
      [showCurrentPageReport]="true"
      [lazy]="true"
      [columnResizeMode]="'expand'"
      styleClass="p-datatable-gridlines p-datatable-sm">
      <ng-template pTemplate="header">
        <tr>
          <th>Статус автоматических проверок AntiFraud</th>
          <th>Сработавшие правила автоматических проверок AntiFraud</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-detailsItem>
        <tr>
          <td>
            {{ detailsItem.status }}
          </td>
          <td>
            {{ detailsItem.rules }}
          </td>
        </tr>
      </ng-template>
    </p-table>
    <pe-loading-spinner *ngIf="loading"></pe-loading-spinner>
  </div>

  <div class="paragraph">
    <pe-indent [mTop]="4"></pe-indent>
    Ручные проверки
    <pe-indent [mBottom]="4"></pe-indent>
  </div>

  <div class="manual-checks">
    <p-table
      *ngIf="!loading"
      [value]="form.controls.manualChecks.value"
      [scrollable]="true"
      [autoLayout]="true"
      [resizableColumns]="true"
      [showCurrentPageReport]="true"
      [lazy]="true"
      [columnResizeMode]="'expand'"
      styleClass="p-datatable-gridlines p-datatable-sm">
      <ng-template pTemplate="header">
        <tr>
          <th>Тип проверки</th>
          <th>Статус</th>
          <th>Логин пользователя</th>
          <th>Дата начала рассмотрения</th>
          <th>Дата окончания рассмотрения</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-detailsItem>
        <tr style="min-height: 40px">
          <td>
            {{ detailsItem.checkType }}
          </td>
          <td>
            {{ detailsItem.status }}
          </td>
          <td>
            {{ detailsItem.userLogin }}
          </td>
          <td>
            {{ detailsItem.startDate | date : 'dd.MM.yyyy HH:mm'  }}
          </td>
          <td>
            {{ detailsItem.endDate | date : 'dd.MM.yyyy HH:mm'  }}
          </td>
        </tr>
      </ng-template>
    </p-table>
    <pe-loading-spinner *ngIf="loading"></pe-loading-spinner>
  </div>

  <pe-indent [mTop]="4" [mBottom]="4"></pe-indent>

  <div class="buttons">
    <p-button
        (click)="approve()"
        class="bottom-button-approve mr-5"
        label="Подтвердить заявку"
        icon="pi pi-check"
        iconPos="right"
        [disabled]="readonly"
        styleClass="p-button-success">   
    </p-button>
    <p-button
        (click)="cancel()"
        class="bottom-button-cancel"
        label="Отклонить заявку"
        icon="pi pi-times"
        iconPos="right"
        [disabled]="readonly"
        styleClass="p-button-secondary">
    </p-button>
  </div>

  <pe-indent [mTop]="3"></pe-indent>
  
</div>
